<!DOCTYPE html>  
<html lang="de">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Schichtkasse</title>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.27/jspdf.plugin.autotable.min.js"></script>  
    <style>  
        body {  
            font-family: Arial, sans-serif;  
            background-color: #f8f9fa;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            justify-content: center;  
            height: 100vh;  
        }  
        .container {  
            background: white;  
            padding: 20px;  
            border-radius: 12px;  
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);  
            width: 90%;  
            max-width: 450px;  
            text-align: center;  
            max-height: 90vh;  
            overflow-y: auto;  
        }  
        input {  
            width: 80%; /* Eingabefelder schmaler gemacht */  
            padding: 10px;  
            margin: 6px 0;  
            border-radius: 6px;  
            font-size: 16px;  
            border: 1px solid #ddd;  
        }  
        button {  
            width: 100%;  
            padding: 12px;  
            margin: 8px 0;  
            border-radius: 6px;  
            font-size: 16px;  
            border: none;  
            cursor: pointer;  
            transition: 0.3s;  
        }  
        .btn-add { background: #28a745; color: white; }  
        .btn-export { background: #007bff; color: white; }  
        .btn-share { background: #25D366; color: white; }  
        .btn-reset { background: #dc3545; color: white; }  
        .summary-box {  
            background: #e9ecef;  
            padding: 12px;  
            border-radius: 6px;  
            margin: 12px 0;  
            text-align: center;  
            border: 2px solid #007bff;  
        }  
        .summary-item {  
            font-weight: bold;  
            margin: 5px 0;  
        }  
        .entry {  
            text-align: left;  
            padding: 12px;  
            border-bottom: 1px solid #ccc;  
            background: #f1f1f1;  
            border-radius: 6px;  
            margin: 8px 0;  
        }  
        hr { border: none; height: 2px; background: #ccc; margin: 10px 0; }  
    </style>  
</head>  
<body>  

    <div class="container">  
        <h2>üìä Schichtkasse</h2>  

        <input type="number" id="summe" placeholder="Summe (‚Ç¨)" required>  
        <input type="number" id="gegeben" placeholder="Gegeben (‚Ç¨)" required>  
        <input type="number" id="rueckgeld" placeholder="R√ºckgeld (‚Ç¨)" required>  
        <input type="number" id="ecZahlung" placeholder="EC-Zahlung (‚Ç¨)" required>  

        <button class="btn-add" onclick="addEntry()">‚ûï Berechnen</button>  

        <div id="output"></div>  

        <hr>  
        <hr>  

        <button class="btn-export" onclick="exportPDF()">üìÑ PDF speichern</button>  
        <button class="btn-share" onclick="shareWhatsApp()">üì± Teilen via WhatsApp</button>  
        <button class="btn-reset" onclick="resetData()">üóëÔ∏è Alle Daten l√∂schen</button>  
    </div>  

    <script>  
        let einnahmen = JSON.parse(localStorage.getItem("einnahmen")) || [];  

        function addEntry() {  
            let summe = parseFloat(document.getElementById("summe").value) || 0;  
            let gegeben = parseFloat(document.getElementById("gegeben").value) || 0;  
            let rueckgeld = parseFloat(document.getElementById("rueckgeld").value) || 0;  
            let ecZahlung = parseFloat(document.getElementById("ecZahlung").value) || 0;  
              
            let trinkgeld = Math.max(gegeben - summe - rueckgeld, 0);  
            let einnahme = summe + ecZahlung;  
            let timestamp = new Date().toLocaleString("de-DE");  

            einnahmen.push({ summe, gegeben, rueckgeld, ecZahlung, trinkgeld, einnahme, timestamp });  
            localStorage.setItem("einnahmen", JSON.stringify(einnahmen));  

            document.getElementById("summe").value = "";  
            document.getElementById("gegeben").value = "";  
            document.getElementById("rueckgeld").value = "";  
            document.getElementById("ecZahlung").value = "";  

            displayEntries();  
        }  

        function displayEntries() {  
            let output = document.getElementById("output");  
            output.innerHTML = "";  
            let totalBar = 0, totalEC = 0, totalTrinkgeld = 0;  

            einnahmen.forEach(entry => {  
                totalBar += entry.summe;  
                totalEC += entry.ecZahlung;  
                totalTrinkgeld += entry.trinkgeld;  

                output.innerHTML += `  
                    <div class="entry">  
                        üìÖ ${entry.timestamp}<br>  
                        üíµ Summe: ${entry.summe.toFixed(2)}‚Ç¨<br>  
                        ü§ë Gegeben: ${entry.gegeben.toFixed(2)}‚Ç¨<br>  
                        üí∞ R√ºckgeld: ${entry.rueckgeld.toFixed(2)}‚Ç¨<br>  
                        üí≥ EC-Zahlung: ${entry.ecZahlung.toFixed(2)}‚Ç¨<br>  
                        üí∞ Trinkgeld: ${entry.trinkgeld.toFixed(2)}‚Ç¨  
                    </div>  
                `;  
            });  

            output.innerHTML += `  
                <hr>  
                <hr>  
                <div class="summary-box">  
                    <div class="summary-item">üíµ Gesamt Bar: ${totalBar.toFixed(2)}‚Ç¨</div>  
                    <div class="summary-item">üí≥ Gesamt EC-Zahlungen: ${totalEC.toFixed(2)}‚Ç¨</div>  
                    <div class="summary-item">üí∞ Gesamt Trinkgeld: ${totalTrinkgeld.toFixed(2)}‚Ç¨</div>  
                    <hr>  
                    <div class="summary-item">üìÜ Gesamteinnahmen: ${(totalBar + totalEC).toFixed(2)}‚Ç¨</div>  
                </div>  
            `;  
        }  

        function exportPDF() {  
            const { jsPDF } = window.jspdf;  
            let pdf = new jsPDF();  
            pdf.text("Schichtkasse - √úbersicht", 10, 10);  

            pdf.autoTable({  
                head: [["Datum", "Summe (‚Ç¨)", "Gegeben (‚Ç¨)", "R√ºckgeld (‚Ç¨)", "Trinkgeld (‚Ç¨)", "EC (‚Ç¨)", "Einnahmen (‚Ç¨)"]],  
                body: einnahmen.map(entry => [  
                    entry.timestamp, entry.summe.toFixed(2), entry.gegeben.toFixed(2), entry.rueckgeld.toFixed(2),  
                    entry.trinkgeld.toFixed(2), entry.ecZahlung.toFixed(2), entry.einnahme.toFixed(2)  
                ])  
            });  

            let date = new Date().toLocaleDateString("de-DE").replace(/\./g, "-");  
            pdf.save(`Schichtkasse_${date}.pdf`);  
        }  

        function shareWhatsApp() {  
            window.open("https://wa.me/?text=Schichtkasse%20aktualisiert!", "_blank");  
        }  

        function resetData() {  
            localStorage.removeItem("einnahmen");  
            einnahmen = [];  
            displayEntries();  
        }  

        window.onload = displayEntries;  
    </script>  
</body>  
</html>
